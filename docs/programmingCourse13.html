<!DOCTYPE html>
<html>
<head>
  <title>javascript プログラミング講座 第13回</title>
  <meta charset="utf-8">
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=css&skin=Default"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="programmingCourse.css">
  <script src="programmingCourse.js"></script>
  <script src="programmingCourse13.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
</head>

<body>
<div class="box1">
  <h1>プログラミング講座 第13回</h1>
  <p>第13回の目標：プログラミングを通してデータベースについて理解を深める。</p>

  <h2>1.データベースの概要</h2>
  <p><span class="stronger">データベース(DataBase,DB)</span>とはデータを構造化して蓄積し、利用しやすいようにするものである。2025年時点では<span class="stronger">関係データベース(Relational DataBase,RDB)</span>が多く使われている。以降はRDBの説明である。</p>

  <h2>2.RDBの基本</h2>
  <h3>2-1.テーブル</h3>
  <table border="1" class="BGstronger">
    <tr><td>生徒ID</td><td>氏名</td><td>住所</td></tr>
    <tr><td>1001</td><td>A子</td><td>MM町</td></tr>
    <tr><td>1002</td><td>B子</td><td>NN町</td></tr>
    <tr><td>1003</td><td>C子</td><td>OO町</td></tr>
  </table>
  <p>RDBではエクセルの表のようなデータを扱う。表を<span class="stronger">テーブル</span>という。普通データベースはいくつものテーブルを持つ。<p>
  <h3>2-2.カラム</h2>
  <table border="1">
    <tr><td>生徒ID</td><td class="BGstronger">氏名</td><td>住所</td></tr>
    <tr><td>1001</td><td class="BGstronger">A子</td><td>MM町</td></tr>
    <tr><td>1002</td><td class="BGstronger">B子</td><td>NN町</td></tr>
    <tr><td>1003</td><td class="BGstronger">C子</td><td>OO町</td></tr>
  </table>
  <p>表の列を<span class="stronger">カラム</span>や<span class="stronger">フィールド</span>という。この講座ではカラムと呼ぶことにする。通常、カラムごとに数値のデータが格納されるとか、文字列のデータが格納されるなどのデータの型が決まっている。<p>
  <h3>2-3.レコード</h3>
  <table border="1">
    <tr><td>生徒ID</td><td>氏名</td><td>住所</td></tr>
    <tr><td>1001</td><td>A子</td><td>MM町</td></tr>
    <tr class="BGstronger"><td>1002</td><td>B子</td><td>NN町</td></tr>
    <tr><td>1003</td><td>C子</td><td>OO町</td></tr>
  </table>
  <p>テーブルにおける行を<span class="stronger">レコード</span>や<span class="stronger">ロウ</span>という。この講座ではレコードと呼ぶことにする。エクセル等の表計算ソフトではせいぜい数千行のデータを扱うが、データベースではそれより多くのデータを扱うことができる。<p>
  <h3>2-4.フィールド</h3>
  <table border="1">
    <tr><td>生徒ID</td><td>氏名</td><td>住所</td></tr>
    <tr><td>1001</td><td>A子</td><td>MM町</td></tr>
    <tr><td>1002</td><td>B子</td><td>NN町</td></tr>
    <tr><td>1003</td><td class="BGstronger">C子</td><td>OO町</td></tr>
  </table>
  <p>フィールドという用語には少々注意が必要で、2-2の意味で(つまりカラムと同じ意味で)フィールドということもあれば、表における一つのセルの値を指すこともある。<p>
  

  <h2>3.DBMSの機能</h2>
  <p>DBが倉庫だとすると、倉庫を管理する存在として<span class="stronger">データベースマネージメントシステム(DBMS)</span>がある。DBMSがデータを操作する機能を提供しており、データを操作する命令を記述する言語は<span class="stronger">SQL(Structured Query Language)</span>とよばれる。</p>

  <p>他にも、例えばAさんがBさんにお金を1000円振り込むとする。Aさんの口座から1000円を引く操作とBさんの口座に1000円を足す操作はかならずセットで行われなければならないことが分かるだろう。このように操作のかたまりを決めて、それが全部行われる（またはエラー時にはまったく行われない）ようにするような気の利いた機能などをDBMSは持っている。が、この講座では詳しく触れない。</p>

  <h2>4.SQLの基本</h2>
  <p>SQLはDBMSに「こういうデータが欲しい」「このデータを追加して」と命令するための言語である。DBMSに対する命令を<span class="stronger">クエリ</span>ということもある。</p>
  <p>SQLの文法はこれまで学んできたjavascriptとは<span class="stronger">別</span>である。新たな言語を覚えるのを大変に感じる人もいるかもしれないが、SQLの文法は簡単であるので心配はいらない。</p>
  <p>SQLは大文字と小文字を区別しないが、SQLのキーワードは大文字、テーブル名やカラム名は小文字で書くのが慣例である。</p>
  <p>また、あるレコードのあるカラムに値が設定されていない場合、NULLという特別な値になる。値が設定されていないという意味の値である。</p>

  <h3>4-1.SELECT</h3>
  <p>まずはデータベースからデータを取り出すため命令を扱う。</p>
  <pre class="prettyprint lang-js linenums">
  SELECT * FROM students;
  </pre>
  <p>上記はstudentsテーブルの全てのレコードを取得する命令である。*はすべてのカラムを表す。セミコロン（;）は、命令の終わりを示す。</p>

  <p class="reidaibox"><span class="reidai">例題1</span> studentsテーブルの全てのレコードを取得せよ。</p>
  <textarea id="inputBox01"></textarea>
  <button onClick="kakunin01()">確認する</button>
  <div id="result01">結果:</div>

  <h3>4-2.SELECT(カラムを指定)</h3>

  <pre class="prettyprint lang-js linenums">
  SELECT studentID, name FROM students;
  </pre>

  <p>SELECT文ではすべてのカラムを取得しなくともよい。上記でstudentsテーブルのstudentIDとnameのカラムを取得することができる。</p>

  <p class="reidaibox"><span class="reidai">例題2</span> studentsテーブルのstudentID, name, addressのカラムを取得せよ。</p>
  <textarea id="inputBox02"></textarea>
  <button onClick="kakunin02()">確認する</button>
  <div id="result02">結果:</div>

  <h3>4-3.SELECT(レコードを絞りこみ)</h3>

  <pre class="prettyprint lang-js linenums">
  SELECT * FROM students WHERE address = 'HH町';
  </pre>

  <p>SELECT文ではすべてのレコードを取得しなくともよい。上記でstudentsテーブルのaddressが HH町 であるデータを取得できる。</p>
  <p>文法としては<span class="stronger">WHERE 絞り込み条件</span>である。</p>
  <p>SQLにおいて、<span class="stronger">等しいは=である</span>。文字列はシングルクオーテーション(')で挟む必要がある。数値はシングルクオーテーション(')で挟まない。使える比較演算子をいくつか示す。</p>
  <table border=1>
    <tr><td>比較演算子</td><td>意味</td></tr>
    <tr><td>A=B</td><td>AとBが等しい</td></tr>
    <tr><td>A<>B</td><td>AとBが等しくない</td></tr>
    <tr><td>A>B</td><td>AがBより大きい</td></tr>
    <tr><td>A>=B</td><td>AがB以上である</td></tr>
    <tr><td>A&lt;B</td><td>AがBより小さい</td></tr>
    <tr><td>A&lt;=B</td><td>AがB以下である</td></tr>
    <tr><td>A BETWEEN B AND C</td><td>AがBとCの間にある(境界は含む)</td></tr>
    <tr><td>A IS NULL</td><td>AがNULLである</td></tr>
  </table>

  <p class="reidaibox"><span class="reidai">例題3</span> studentsテーブルのすべてのカラムをweightが55以上のもののみ取得せよ。</p>
  <textarea id="inputBox03"></textarea>
  <button onClick="kakunin03()">確認する</button>
  <div id="result03">結果:</div>

  <p class="reidaibox"><span class="reidai">例題4</span> studentsテーブルのstudentID, name, heightをheightが150から160までのもののみ取得せよ。</p>
  <textarea id="inputBox04"></textarea>
  <button onClick="kakunin04()">確認する</button>
  <div id="result04">結果:</div>

  <h3>4-4.SELECT(複数条件)</h3>
  <p>WHERE節では複数の条件を指定することもできる。</p>

  <pre class="prettyprint lang-js linenums">
  SELECT * FROM students WHERE height >= 160 AND weight >= 60;
  </pre>
  <p>上記でheightが160以上でかつweightが60以上のレコードを取得することができる。</p>
  <p>この例のANDのようなものを<span class="stronger">論理演算子</span>というが、ANDのほか、OR、NOTも使える。</p>

  <p class="reidaibox"><span class="reidai">例題5</span> studentsテーブルのstudentID,name,addressをaddressが HH町 かまたは II町 であるもののみ取得せよ。</p>
  <textarea id="inputBox05"></textarea>
  <button onClick="kakunin05()">確認する</button>
  <div id="result05">結果:</div>

  <h3>4-5.SELECT(JOIN)</h3>
  <p>これまでは1つのテーブルからデータを取り出してきた。一方、実際の運用では複数のテーブルにまたがった情報が必要になることがある。</p>
  <p>そんなときは共通のキーを基にテーブルを結合し、一つの大きなテーブルのように扱ってデータを抽出する<span class="stronger">JOIN(結合)</span>という機能を使う。JOINにはINNER JOINとOUTER JOINがある。</p>

  <h3>4-5-1.INNER JOIN (内部結合)</h3>
  <p>INNER JOINは2つのテーブルを結合するが、キーが両方のテーブルに存在するデータたちのみ取得する。</p>

  <pre class="prettyprint lang-js linenums">
  SELECT students.name, club.clubname FROM students JOIN club ON students.clubID = club.clubID;
  </pre>
  <p>文法としては<span class="stronger">FROM</span> students <span class="stronger">JOIN</span> club <span class="stronger">ON 結合の条件</span>となっているところに注意せよ。</p>
  <p>そして取得する内容や結合の条件を記述する際に、カラム名を指定するには<span class="stronger">テーブル名.カラム名</span>のように、ドット(.)でつないで書くことにも注意せよ。</p>
  <p>この例では、studentsとclubという2つのテーブルを結合している。結合するときキーになっているのがclubIDカラムである。studentsテーブルにも、clubテーブルにもclubIDカラムがある。それらが値を持ち、さらに等しいデータのみが取得される。</p>
  <p>この方法だとstudentsの全員は表示されない。studentsテーブルの何人かはclubIDを持っていない(NULL)からである。</p>

  <p class="reidaibox"><span class="reidai">例題6</span> studentsテーブルとclubテーブルをclubIDをキーにINNER JOINせよ。</p>
  <textarea id="inputBox06"></textarea>
  <button onClick="kakunin06()">確認する</button>
  <div id="result06">結果:</div>

  <h3>4-5-2.LEFT OUTER JOIN (外部結合)</h3>
  <p>INNER JOINは両方のテーブルにキーが存在するデータたちのみ取得する方法であった。つまりINNER JOINで2つのテーブルを結合すると、どちらのテーブルのデータも欠ける可能性がある。</p>
  <p>これに対して、片方のテーブルを優先し、優先するテーブルのレコードはすべて含まれるようにする結合方法をOUTER JOINという。キーが無い部分はNULLとなる。</p>

  <pre class="prettyprint lang-js linenums">
  SELECT students.name, club.clubname FROM students LEFT JOIN club ON students.clubID = club.clubID;
  </pre>
  <p>文法としては<span class="stronger">FROM</span> students <span class="stronger"> LEFT JOIN</span> club <span class="stronger">ON 結合の条件</span>である。文法はINNER JOINとよく似ていて、LEFTが増えただけである。</p>
  <p>この方法だと、studentsの全員が表示され、clubIDを持っていないもののclubnameはNULLになる。</p>

  <p class="reidaibox"><span class="reidai">例題7</span> studentsテーブルとclubテーブルをclubIDをキーにLEFT OUTER JOINせよ。</p>
  <textarea id="inputBox07"></textarea>
  <button onClick="kakunin07()">確認する</button>
  <div id="result07">結果:</div>

  <h3>4-6.JOIN してさらに絞り込み</h3>
  <p>JOINとWHERE節は併用できる。WHERE節はJOIN節の後に書く。</p>
  <pre class="prettyprint lang-js linenums">
  SELECT * FROM students JOIN club ON students.clubID = club.clubID WHERE club.clubID = 1;
  </pre>

  <p class="reidaibox"><span class="reidai">例題8</span> studentsテーブルとclubテーブルをclubIDをキーにINNER JOINし、さらにclubIDが3のもののみ取得せよ。</p>
  <textarea id="inputBox08"></textarea>
  <button onClick="kakunin08()">確認する</button>
  <div id="result08">結果:</div>

  <h3>4-7.ORDER BY(並び替え)</h3>
  <p>取得するレコードたちを並び変えることもできる。</p>

  <pre class="prettyprint lang-js linenums">
  SELECT * FROM students ORDER BY height ASC;
  </pre>
  <p>この例では、studentsテーブルのデータたちをheightの順に(小さいほうから大きいほうへ)並べて取得する。</p>
  <p>文法としては、<span class="stronger">ORDER BY カラム名 ASC(またはDESC)</span>であることに注意せよ。またWHERE節がある場合は、ORDER BY節はその後に書く。</p>
  <p>大きいほうから小さいほうへ並べるためにはASCの代わりにDESCと書く。<span class="stronger">ASC、DESCの記載は省略してもよい</span>がその場合はASCとして扱われる。</p>
  <p>OERDER BYの後に、コンマ(,)でつなげて複数のカラム名を書くと、書いた順に優先されて、複数の条件で並び変えることができる。まず優先度の高いカラムの値で並べ、その値が等しいときのみ優先度の低いカラムの順で並べる方式である。</p>

  <p class="reidaibox"><span class="reidai">例題9</span> studentsテーブルのデータをweightの大きい順に取得せよ。</p>
  <textarea id="inputBox09"></textarea>
  <button onClick="kakunin09()">確認する</button>
  <div id="result09">結果:</div>


  <p class="reidaibox"><span class="reidai">例題10</span> compositionテーブルには、studentIDカラム、nendoカラム(年度)、gakunenカラム(学年)、classカラム(組)、bangouカラム(出席番号)がある。すべてのカラムは数値型である。例題1などで用いたstudentsテーブルとcompositionテーブルを用いて、2025年度の名簿を表示せよ。名簿には、学年、組、出席番号、氏名が表示されるようにせよ。</p>
  <textarea id="inputBox10"></textarea>
  <button onClick="kakunin10()">確認する</button>
  <div id="result10">結果:</div>

  <p>ここまでSQLで最もよく使われる、データを取得する機能であるSELECT文を扱った。SELECT文には、ここで紹介した他にも合計、平均を算出する機能などがある。</p>
  <p>SQLにはSELECT文の他にも、テーブルにレコードを追加するINSERT文、テーブルからレコードを削除するDELETE文、テーブルのレコードを更新するUPDATE文、テーブルを作成するCREATE文、テーブルを削除するDROP文などがある。</p>

  <p>
    <a href="programmingCourse12.5.html">第12.5回へ</a> <a href="index.html">目次へ</a> <a href="programmingCourse14.html">第14回へ</a>
  </p>
</div>
</body>
</html>